<view class="container">
  <view class="header">
    <image class="header-icon" src="/images/frieren004.jpg" mode="aspectFill" />
    <text class="header-title">旅时手记</text>
    <text class="header-subtitle">存放旅途中瞥见星光的地方</text>
  </view>

  <view class="tabs">
    <view 
      class="tab {{activeTab === index ? 'active' : ''}}"
      wx:for="{{tabs}}"
      wx:key="index"
      data-index="{{index}}"
      bindtap="switchTab"
    >
      {{item}}
    </view>
  </view>

  <view class="tab-content" wx:if="{{activeTab === 0}}">
    <view class="section-intro">
      <text class="intro-text">标记触动你的瞬间，写下此刻所想</text>
    </view>

    <button class="add-btn" bindtap="openAddEmotion">+ 添加刻印</button>

    <view class="emotion-list">
      <view class="emotion-card" wx:for="{{emotions}}" wx:key="id">
        <view class="emotion-header">
          <view class="emotion-tag tag-{{item.tagIndex}}">{{item.tag}}</view>
          <text class="emotion-date">{{item.date}}</text>
        </view>
        <text class="emotion-moment">{{item.moment}}</text>
        <text class="emotion-thought">{{item.thought}}</text>
        <view class="emotion-delete" data-id="{{item.id}}" bindtap="deleteEmotion">删除</view>
      </view>

      <view class="empty-state" wx:if="{{emotions.length === 0}}">
        <text class="empty-text">还没有刻印\n点击上方按钮开始记录</text>
      </view>
    </view>
  </view>

  <view class="tab-content" wx:if="{{activeTab === 1}}">
    <view class="section-intro">
      <text class="intro-text">探索作品中的细节与设定</text>
    </view>

    <view class="discovery-list">
      <view 
        class="discovery-card"
        wx:for="{{discoveries}}"
        wx:key="id"
        data-item="{{item}}"
        bindtap="viewDiscovery"
      >
        <text class="discovery-icon">{{item.icon}}</text>
        <view class="discovery-content">
          <text class="discovery-title">{{item.title}}</text>
          <text class="discovery-subtitle" wx:if="{{item.subtitle}}">{{item.subtitle}}</text>
        </view>
        <text class="discovery-arrow">›</text>
      </view>
    </view>
  </view>

  <view class="tab-content" wx:if="{{activeTab === 2}}">
    <view class="section-intro">
      <text class="intro-text">与作品哲学相关的开放性话题</text>
    </view>

    <view class="question-card">
      <text class="question-text">{{currentQuestion.question}}</text>
    </view>

    <button class="add-btn" bindtap="openAddResponse">+ 写下你的回应</button>

    <view class="response-list">
      <view class="response-card" wx:for="{{currentQuestion.responses}}" wx:key="id">
        <text class="response-content">{{item.content}}</text>
        <view class="response-footer">
          <text class="response-date">{{item.date}}</text>
          <view class="response-delete" data-id="{{item.id}}" bindtap="deleteResponse">删除</view>
        </view>
      </view>

      <view class="empty-state" wx:if="{{currentQuestion.responses.length === 0}}">
        <text class="empty-text">还没有回应\n点击上方按钮分享你的思考</text>
      </view>
    </view>
  </view>

  <view class="modal" wx:if="{{showAddEmotion}}" bindtap="closeAddEmotion">
    <view class="modal-content" catchtap="stopPropagation">
      <text class="modal-title">添加情感刻印</text>
      
      <view class="form-group">
        <text class="form-label">选择标签</text>
        <view class="tag-selector">
          <view 
            class="tag-option tag-{{index}} {{newEmotionTag === index ? 'selected' : ''}}"
            wx:for="{{emotionTags}}"
            wx:key="index"
            data-index="{{index}}"
            bindtap="selectEmotionTag"
          >
            {{item}}
          </view>
        </view>
      </view>

      <view class="form-group">
        <text class="form-label">触动的瞬间</text>
        <input 
          class="form-input"
          placeholder="如：第一次为他人流泪"
          value="{{newEmotionMoment}}"
          bindinput="onMomentInput"
        />
      </view>

      <view class="form-group">
        <text class="form-label">此刻所想</text>
        <textarea 
          class="form-textarea"
          placeholder="写下你的感想..."
          value="{{newEmotionThought}}"
          bindinput="onThoughtInput"
          maxlength="500"
        />
      </view>

      <view class="modal-buttons">
        <button class="modal-btn cancel" bindtap="closeAddEmotion">取消</button>
        <button class="modal-btn confirm" bindtap="saveEmotion">保存</button>
      </view>
    </view>
  </view>

  <view class="modal" wx:if="{{showAddResponse}}" bindtap="closeAddResponse">
    <view class="modal-content" catchtap="stopPropagation">
      <text class="modal-title">写下你的回应</text>
      
      <view class="form-group">
        <textarea 
          class="form-textarea large"
          placeholder="分享你的思考..."
          value="{{newResponse}}"
          bindinput="onResponseInput"
          maxlength="500"
        />
      </view>

      <view class="modal-buttons">
        <button class="modal-btn cancel" bindtap="closeAddResponse">取消</button>
        <button class="modal-btn confirm" bindtap="saveResponse">保存</button>
      </view>
    </view>
  </view>
</view>
